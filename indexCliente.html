<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="ALEX ZALAZAR , SANTIAGO BASSO">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" href="https://acdn-us.mitiendanube.com/stores/006/296/350/themes/common/logo-1444518768-1748714067-c86f57064af934abbc8cf8f22bf870571748714067-480-0.webp">
    <title>Document</title>
</head>
<body>
    <header>
        <div class="header-main">
            <div class="header-busqueda">
                <nav class="buscar-producto">
                
                    <input  id="barraBusqueda" type="text" placeholder="¿Que estas buscando?">
                </nav>
                <div class="logo">
                    <img src="https://acdn-us.mitiendanube.com/stores/006/296/350/themes/common/logo-1444518768-1748714067-c86f57064af934abbc8cf8f22bf870571748714067-480-0.webp" alt="logo">
                </div>
                <div class="header-registro" >

                    <!-- //////////////////////////////////////////////////////////////////////////////
                    COLOCAR NOMBRE DE USUARIO
                    /////////////////////////////////////////////////////////////////////////////7//////-->
                    <div class="registro">
                        <ion-icon name="person-outline"></ion-icon>
                        <div>
                            <h6>¡Hola! inicia seccion</h6>
                            <!-- <a href="#" class="crear-cuenta">
                                <p>O puedes registrarte</p>
                            </a> -->
                        </div>
                        
                    </div>
                    <div class="header-carrito">
                        <a href="#">
                            <ion-icon name="cart-outline"></ion-icon>
                            <div class="contenedor-carrito">
                                <div>
                                    <h2>Mi carrito</h2>
                                </div>
                                
                                <aside id="carrito"></aside>
                            </div>
                        </a>
                        
                    </div>
                </div>
                    
            </div>
        </div>
        <div class="header-two">
            <div class="header-nav">
                <nav class="navegacion">
                    <a href="#"><p>INICIO</p></a>
                </nav>
                <nav class=" navegacion">
                    <a href="#"><p>CATEGORIA</p>
                    </a>
                    <div class="contenedor-categoria">
                        <nav class="navegacion navegacion-categoria">
                            <a href="cañaCliente.html"><p>CAÑA</p></a>
                        </nav>
                        <nav class="navegacion navegacion-categoria">
                            <a href="reelCliente.html"><p>REEL</p></a>
                        </nav>
                        
                    </div>
                
                </nav>
            </div>
        </div>
        
          
    </header>
       <main>
        <section id="contenedorProducto"></section>
    </main>
        <footer class="autores">
        <H3>SANTIAGO BASSO</H3>
        <H3>ALEX ZALAZAR</H3>
    </footer>
    <script>
        let contenedorCarrito = document.querySelector("#carrito");
          let contenedorProductos = document.getElementById("contenedorProducto");
        const url = "http://localhost:3000/productos"; // Guardamos en una variable la url de nuestro endpoint
        let productos= null;
        let carrito = [];
        async function obtenerProductos() {
            try {
                let respuesta = await fetch(url); // Hacemos una peticion a nuestro nuevo endpoint en http://localhost:3000/products

                let data = await respuesta.json();

                console.log(data); 

                productos = data.payload; 

                mostrarProductos(productos);

            } catch(error) {
                console.error(error);
            }
        }
        function mostrarProductos(array) {
            console.table(array); // Recibimos correctamente en formato tabla los productos que nos manda la funcion obtenerProductos()

            let htmlProducto = "";

            array.forEach(producto => {
                htmlProducto += `
                    <div class="card-producto">
                        <img src="${producto.img_url}" alt="${producto.nombre}">
                        <h5>${producto.nombre}</h5>
                       
                        <p>$${producto.precio}</p>
                        <button onclick = "agregarACarrito(${producto.id})">Agregar al carrito</button>
                    </div>
                `;
            });

            contenedorProductos.innerHTML = htmlProducto;
        }


        function agregarACarrito(id){
           // let carrito= [];
            console.log(productos);
            carrito.push(productos.find(valor => valor.id == id))
            console.table(carrito);
            mostrarCarrito();


        }
// Muestra el carrito actualizado. Si el array carrito esta vacio lo borra de la memoria y muestra un mensaje
function mostrarCarrito(){
    let cartaCarrito = "";
    if(carrito.length>0)
    {
        cartaCarrito+= "<ul>"
        carrito.forEach((element,indice) => {
            cartaCarrito+= `<li class= "bloque-carrito">
            <div>
            <img src="${element.img_url}" alt="${element.nombre}">
            <p class = "nombre-item">${element.nombre}-$${element.precio}-${indice}</p> </div>
            
            <button class= "eliminar-bloque" onclick="eliminarCarrito(${indice})">Eliminar</button> </li>`;
        });
        //guardarCarritoLocalStorage();
        cartaCarrito+=`</ul><button class= "eliminar-carrito" onclick= "vaciarCarrito()">Vaciar carrito</button>`; 
    }
    else{
       // borrarMemoria();
        cartaCarrito+=`<h4 class= "vacio">Agregue un producto al carrito</h4>`
    }
    
    contenedorCarrito.innerHTML= cartaCarrito;
}




// Si presiona  "vaciar carrito"  inicializa el array a vacio y actualiza el carrito
function vaciarCarrito(){
    carrito= [];
    mostrarCarrito();
}
// si presiona "eliminar" busca el indice del producto y lo elimina. luego actualiza carrito
function eliminarCarrito(indice)
{
    carrito.splice(indice,1);
    mostrarCarrito();
}

        function init() {
            obtenerProductos()
        }

        init();
    </script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</body>
</html>